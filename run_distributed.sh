#!/usr/bin/env bash

LOCUST="/usr/local/bin/locust"
LOCUS_OPTS="-f locustfile.py"
LOCUST_MODE=${LOCUST_MODE:-standalone}

if [[ "$LOCUST_MODE" = "master" ]]; then
    LOCUS_OPTS="${LOCUS_OPTS} --master"

elif [[ "$LOCUST_MODE" = "worker" ]]; then
    LOCUS_OPTS="${LOCUS_OPTS} --slave --master-host=${LOCUST_MASTER}"
fi

echo "SCHEMA_NAME=${SCHEMA_NAME} USER_WAIT_TIME_MIN_SECONDS=${USER_WAIT_TIME_MIN_SECONDS} USER_WAIT_TIME_MAX_SECONDS=${USER_WAIT_TIME_MAX_SECONDS} REQUESTS_JSON=${REQUESTS_JSON} HOST=${HOST} $LOCUST $LOCUS_OPTS"

SCHEMA_NAME=${SCHEMA_NAME} USER_WAIT_TIME_MIN_SECONDS=${USER_WAIT_TIME_MIN_SECONDS} USER_WAIT_TIME_MAX_SECONDS=${USER_WAIT_TIME_MAX_SECONDS} REQUESTS_JSON=${REQUESTS_JSON} HOST=${HOST} ${LOCUST} ${LOCUS_OPTS}
