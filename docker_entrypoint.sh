#!/usr/bin/env bash

echo "Running locust"
echo "USER_WAIT_TIME_MIN_SECONDS=${USER_WAIT_TIME_MIN_SECONDS} USER_WAIT_TIME_MAX_SECONDS=${USER_WAIT_TIME_MAX_SECONDS} REQUESTS_JSON=${REQUESTS_JSON} HOST=${HOST} INCLUDE_SURVEY_URL_IN_TOKEN=${INCLUDE_SURVEY_URL_IN_TOKEN}"
echo "locust $LOCUST_OPTS"

USER_WAIT_TIME_MIN_SECONDS=${USER_WAIT_TIME_MIN_SECONDS} USER_WAIT_TIME_MAX_SECONDS=${USER_WAIT_TIME_MAX_SECONDS} REQUESTS_JSON=${REQUESTS_JSON} HOST=${HOST} INCLUDE_SURVEY_URL_IN_TOKEN=$(INCLUDE_SURVEY_URL_IN_TOKEN) locust $LOCUST_OPTS

if [[ -n ${GCS_OUTPUT_BUCKET} ]]; then
    echo "Storing benchmark outputs"
    python -m scripts.store_benchmark_outputs
fi
