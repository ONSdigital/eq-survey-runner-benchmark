# Relationship Test September 2020

To test the effect of relationship performance (response time) when increasing household members up to 30.

Using test_relationships.json, household members are to be added using the list collector, relationships questions are then answered for each. The test concludes with the removal of all members and submission.

Test conditions
The test was conducted using 2 GCP instances, one load injector and one with the application deployed. Both instances were built from our [pipelines repo](https://github.com/ONSdigital/eq-pipelines), one matching the [daily test load injector](https://github.com/ONSdigital/eq-pipelines/tree/master/performance-testing/daily-test) and one matching the [development test environment](https://github.com/ONSdigital/eq-pipelines/tree/master/development/test).

As a calibration excise, I verified that the results from the daily benchmark test matched the newly build environment when using the census_household_gb_eng.json request file over 20 minutes.

Latest Daily Performance Metrics (6th September 2020, taken from Slack)
GETs average: 100ms
POSTs average: 125ms
All requests average: 112ms


New environment
GETs average: 100ms
POSTs average: 121ms
All requests average: 111ms

This confirmed that the new environment was configured and performing the same as the daily benchmark.


## Test settings

| Setting | Value |
| --- | ---|
| Clients per instance | 64 |
| Clients hatch rate   | 64 |
| Wait time minimum | 1 |
| Wait time maximum | 2 |
| Requests JSON | test_relationships.json |
| Runtime | 20m |


## Results

| Household Members | GET (ms) | POST (ms) | Average (ms) |
|-------------------|----------|-----------|--------------|
| 5                 | 96       | 105       | 100          |
| 10                | 82       | 104       | 92           |
| 20                | 91       | 115       | 103          |
| 30 (1st test)     | 118      | 162       | 140          |
| 30 (2nd test)     | 114      | 150       | 132          |

- All results were recorded at the 99th percentile
- Approximately 135k requests were generated by each test
- No errors or failures were recorded in any of the test


## Observations

- Having 5/10 households members made no difference, and in fact returned slightly lower figures than the benchmark/calibrated results. I would put this down to natural deviation in testing and not worth further investigation.
- Having 20 members in a household had a slightly higher POST time, but its marginal.
- Having 30 members in the household produced a clear increase in response times ≈20% for GETs and ≈30% for POSTs, this was significant enough for me to repeat the test, which returned the same findings.


## Recommendations

- Although there is a noticeable performance decrease in performance from 20 to 30 household members, I don't believe it's significant enough to recommend any changes aimed at optimizing how relationships work.
- Even at 30 household members I believe the response time is acceptable. If we did decide to make improvements, considering the amount of households it would affect, I would make it very low priority.
- Monitor the performance of relationships regularly doesn't seem necessary, but might be nice to have.
- Relationship performance deviates only slightly from other block types, this doesn't warrant extra monitoring on its own, but could as a bigger piece if we were to split up major block types when reporting benchmark results.